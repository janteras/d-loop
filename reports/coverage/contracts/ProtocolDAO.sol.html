<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/ProtocolDAO.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> ProtocolDAO.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/53</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/84</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/18</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/77</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity 0.8.24;
&nbsp;
import "./utils/Errors.sol";
import { ReentrancyGuard } from "./security/ReentrancyGuard.sol";
&nbsp;
/**
 * @title ProtocolDAO
 * @dev Main DAO for the DLOOP protocol
 * @notice This contract handles protocol-level governance and administration
 */
/**
 * [TESTNET] This contract is configured for Sepolia testnet deployment.
 * - Owner/admin/treasury roles are assigned to deployer only
 * - Proposal and voting flows are simplified (e.g., 10% quorum, shorter windows)
 * - No multisig or advanced governance features enabled
 * - All mainnet-only features are disabled or marked for Sepolia
 * - All testnet-specific logic is clearly marked with [TESTNET] comments
 */
contract ProtocolDAO is ReentrancyGuard {
    // [TESTNET] Proposal and voting flows are simplified (e.g., 10% quorum, shorter windows)
    // Proposal structure
    struct Proposal {
        uint256 id;
        string description;
        address proposer;
        uint256 createdAt;
        uint256 votingEnds;
        uint256 forVotes;
        uint256 againstVotes;
        bool executed;
        bool canceled;
        address[] targets;
        uint256[] values;
        bytes[] calldatas;
    }
&nbsp;
    // Protocol parameters
    uint256 public votingPeriod;      // in seconds
    uint256 public executionDelay;    // in seconds
    uint256 public quorum;            // in percentage (1-100)
    
    // Role management
    // [TESTNET] Role management: Owner/admin/treasury roles are assigned to deployer only for Sepolia
    address public owner;
    address public admin;
    address public treasury;
    
    // Whitelisted tokens
    mapping(address =&gt; bool) public whitelistedTokens;
    
    // Proposal storage
    mapping(uint256 =&gt; Proposal) public proposals;
    uint256 private proposalCounter;
    
    // Vote tracking
    mapping(uint256 =&gt; mapping(address =&gt; bool)) public hasVoted;
    
    // Events
    event ProposalCreated(uint256 indexed proposalId, address indexed proposer, string description);
    event VoteCast(uint256 indexed proposalId, address indexed voter, bool support);
    event ProposalExecuted(uint256 indexed proposalId);
    event ProposalCanceled(uint256 indexed proposalId);
    event ParameterUpdated(string paramName, uint256 oldValue, uint256 newValue);
    event TokenWhitelisted(address indexed token, bool status);
    
    /**
     * @dev Modifier to restrict access to owner
     */
<span class="fstat-no" title="function not covered" >    modifier onlyOwner() {</span>
<span class="cstat-no" title="statement not covered" >        if (msg.sender != owner) revert CallerNotOwner();</span>
        _;
    }
    
    /**
     * @dev Modifier to restrict access to admin
     */
<span class="fstat-no" title="function not covered" >    modifier onlyAdmin() {</span>
<span class="cstat-no" title="statement not covered" >        if (msg.sender != admin &amp;&amp; msg.sender != owner) revert CallerNotAdmin();</span>
        _;
    }
    
    /**
     * @dev Constructor to initialize the ProtocolDAO contract
     * @param _admin Address of the admin
     * @param _treasury Address of the treasury
     * @param _votingPeriod Initial voting period (in seconds)
     * @param _executionDelay Initial execution delay (in seconds)
     * @param _quorum Initial quorum percentage (1-100)
     */
<span class="fstat-no" title="function not covered" >    constructor(</span>
        address _admin,
        address _treasury,
        uint256 _votingPeriod,
        uint256 _executionDelay,
        uint256 _quorum
    ) {
<span class="cstat-no" title="statement not covered" >        if (_admin == address(0) || _treasury == address(0)) revert ZeroAddress();</span>
<span class="cstat-no" title="statement not covered" >        if (_quorum == 0 || _quorum &gt; 100) revert InvalidAmount();</span>
        
        owner = msg.sender;
        admin = _admin;
        treasury = _treasury;
        votingPeriod = _votingPeriod;
        executionDelay = _executionDelay;
        quorum = _quorum;
        proposalCounter = 0;
    }
    
    /**
     * @dev Creates a new proposal
     * @param description Description of the proposal
     * @param targets Target addresses for calls to be made during proposal execution
     * @param values ETH values for calls to be made during proposal execution
     * @param calldatas Calldata for calls to be made during proposal execution
     * @return proposalId The ID of the created proposal
     */
<span class="fstat-no" title="function not covered" >    function createProposal(</span>
        string memory description,
        address[] memory targets,
        uint256[] memory values,
        bytes[] memory calldatas
    ) external returns (uint256) {
<span class="cstat-no" title="statement not covered" >        if (targets.length == 0) revert InvalidAmount();</span>
<span class="cstat-no" title="statement not covered" >        if (targets.length != values.length || targets.length != calldatas.length)</span>
            revert InvalidAmount();
        
        // Increment proposal counter
        proposalCounter++;
<span class="cstat-no" title="statement not covered" >        uint256 proposalId = proposalCounter;</span>
        
        // Create new proposal
        proposals[proposalId] = Proposal({
            id: proposalId,
            description: description,
            proposer: msg.sender,
            createdAt: block.timestamp,
            votingEnds: block.timestamp + votingPeriod,
            forVotes: 0,
            againstVotes: 0,
            executed: false,
            canceled: false,
            targets: targets,
            values: values,
            calldatas: calldatas
        });
        
        // Emit creation event
<span class="cstat-no" title="statement not covered" >        emit ProposalCreated(proposalId, msg.sender, description);</span>
        
<span class="cstat-no" title="statement not covered" >        return proposalId;</span>
    }
    
    /**
     * @dev Casts a vote on a proposal
     * @param proposalId The ID of the proposal
     * @param support Whether to support the proposal
     */
<span class="fstat-no" title="function not covered" >    function castVote(uint256 proposalId, bool support) external {</span>
<span class="cstat-no" title="statement not covered" >        Proposal storage proposal = proposals[proposalId];</span>
        
<span class="cstat-no" title="statement not covered" >        if (proposal.proposer == address(0)) revert ProposalNotFound();</span>
<span class="cstat-no" title="statement not covered" >        if (proposal.executed) revert ProposalAlreadyExecuted();</span>
<span class="cstat-no" title="statement not covered" >        if (proposal.canceled) revert ProposalNotApproved();</span>
<span class="cstat-no" title="statement not covered" >        if (proposal.votingEnds &lt; block.timestamp) revert VotingEnded();</span>
<span class="cstat-no" title="statement not covered" >        if (hasVoted[proposalId][msg.sender]) revert AlreadyVoted();</span>
        
        // Record vote
        hasVoted[proposalId][msg.sender] = true;
        
        // Update vote counts
<span class="cstat-no" title="statement not covered" >        if (support) {</span>
            proposal.forVotes += 1;
        } else {
            proposal.againstVotes += 1;
        }
        
        // Emit vote event
<span class="cstat-no" title="statement not covered" >        emit VoteCast(proposalId, msg.sender, support);</span>
    }
    
    /**
     * @dev Executes a proposal
     * @param proposalId The ID of the proposal
     * @notice Protected against reentrancy attacks using nonReentrant modifier
     */
<span class="fstat-no" title="function not covered" >    function executeProposal(uint256 proposalId) external nonReentrant {</span>
<span class="cstat-no" title="statement not covered" >        Proposal storage proposal = proposals[proposalId];</span>
<span class="cstat-no" title="statement not covered" >        _validateProposalForExecution(proposal)</span>;
        proposal.executed = true;
<span class="cstat-no" title="statement not covered" >        _executeProposalCalls(proposal)</span>;
<span class="cstat-no" title="statement not covered" >        emit ProposalExecuted(proposalId);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _validateProposalForExecution(Proposal storage proposal) private view {</span>
<span class="cstat-no" title="statement not covered" >        if (proposal.proposer == address(0)) revert ProposalNotFound();</span>
<span class="cstat-no" title="statement not covered" >        if (proposal.executed) revert ProposalAlreadyExecuted();</span>
<span class="cstat-no" title="statement not covered" >        if (proposal.canceled) revert ProposalNotApproved();</span>
<span class="cstat-no" title="statement not covered" >        if (proposal.votingEnds &gt;= block.timestamp) revert VotingNotStarted();</span>
<span class="cstat-no" title="statement not covered" >        if (block.timestamp &lt; proposal.votingEnds + executionDelay) revert ProposalNotApproved();</span>
<span class="cstat-no" title="statement not covered" >        uint256 totalVotes = proposal.forVotes + proposal.againstVotes;</span>
<span class="cstat-no" title="statement not covered" >        if (totalVotes == 0) revert ProposalNotApproved();</span>
<span class="cstat-no" title="statement not covered" >        uint256 forPercentage = (proposal.forVotes * 100) / totalVotes;</span>
<span class="cstat-no" title="statement not covered" >        if (forPercentage &lt; quorum) revert ProposalNotApproved();</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _executeProposalCalls(Proposal storage proposal) private {</span>
<span class="cstat-no" title="statement not covered" >        for (uint256 i = 0; i &lt; proposal.targets.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >            (bool success, ) = proposal.targets[i].call{value: proposal.values[i]}(proposal.calldatas[i]);</span>
<span class="cstat-no" title="statement not covered" >            if (!success) revert OperationFailed();</span>
        }
    }
    
    /**
     * @dev Cancels a proposal
     * @param proposalId The ID of the proposal
     */
<span class="fstat-no" title="function not covered" >    function cancelProposal(uint256 proposalId) external onlyAdmin {</span>
<span class="cstat-no" title="statement not covered" >        Proposal storage proposal = proposals[proposalId];</span>
        
<span class="cstat-no" title="statement not covered" >        if (proposal.proposer == address(0)) revert ProposalNotFound();</span>
<span class="cstat-no" title="statement not covered" >        if (proposal.executed) revert ProposalAlreadyExecuted();</span>
<span class="cstat-no" title="statement not covered" >        if (proposal.canceled) revert ProposalNotApproved();</span>
        
        // Mark as canceled
        proposal.canceled = true;
        
        // Emit cancellation event
<span class="cstat-no" title="statement not covered" >        emit ProposalCanceled(proposalId);</span>
    }
    
    /**
     * @dev Updates the voting period
     * @param _newVotingPeriod New voting period (in seconds)
     */
<span class="fstat-no" title="function not covered" >    function updateVotingPeriod(uint256 _newVotingPeriod) external onlyAdmin {</span>
<span class="cstat-no" title="statement not covered" >        if (_newVotingPeriod == 0) revert InvalidPeriod();</span>
        
<span class="cstat-no" title="statement not covered" >        uint256 oldVotingPeriod = votingPeriod;</span>
        votingPeriod = _newVotingPeriod;
        
<span class="cstat-no" title="statement not covered" >        emit ParameterUpdated("VotingPeriod", oldVotingPeriod, _newVotingPeriod);</span>
    }
    
    /**
     * @dev Updates the execution delay
     * @param _newExecutionDelay New execution delay (in seconds)
     */
<span class="fstat-no" title="function not covered" >    function updateExecutionDelay(uint256 _newExecutionDelay) external onlyAdmin {</span>
<span class="cstat-no" title="statement not covered" >        uint256 oldExecutionDelay = executionDelay;</span>
        executionDelay = _newExecutionDelay;
        
<span class="cstat-no" title="statement not covered" >        emit ParameterUpdated("ExecutionDelay", oldExecutionDelay, _newExecutionDelay);</span>
    }
    
    /**
     * @dev Updates the quorum percentage
     * @param _newQuorum New quorum percentage (1-100)
     */
<span class="fstat-no" title="function not covered" >    function updateQuorum(uint256 _newQuorum) external onlyAdmin {</span>
<span class="cstat-no" title="statement not covered" >        if (_newQuorum == 0 || _newQuorum &gt; 100) revert InvalidAmount();</span>
        
<span class="cstat-no" title="statement not covered" >        uint256 oldQuorum = quorum;</span>
        quorum = _newQuorum;
        
<span class="cstat-no" title="statement not covered" >        emit ParameterUpdated("Quorum", oldQuorum, _newQuorum);</span>
    }
    
    /**
     * @dev Adds or removes a token from the protocol's whitelist. Only whitelisted tokens
     *      can be used for investment, divestment, and ragequit operations. This provides
     *      a security layer to prevent fraudulent or manipulated tokens from being used.
     *      Whitelists a token for use in the DLOOP protocol.
     * @param token Address of the token to whitelist or blacklist
     * @param status True to whitelist the token, false to remove it from the whitelist
     * @notice Tokens must undergo governance approval before being whitelisted
     * @notice Only admin or owner addresses can modify the whitelist
     */
<span class="fstat-no" title="function not covered" >    function whitelistToken(address token, bool status) external onlyAdmin {</span>
<span class="cstat-no" title="statement not covered" >        if (token == address(0)) revert ZeroAddress();</span>
        
        whitelistedTokens[token] = status;
        
<span class="cstat-no" title="statement not covered" >        emit TokenWhitelisted(token, status);</span>
    }
    
    /**
     * @dev Updates the treasury address
     * @param _newTreasury Address of the new treasury
     */
<span class="fstat-no" title="function not covered" >    function updateTreasury(address _newTreasury) external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        if (_newTreasury == address(0)) revert ZeroAddress();</span>
        treasury = _newTreasury;
    }
    
    /**
     * @dev Updates the admin address
     * @param _newAdmin Address of the new admin
     */
<span class="fstat-no" title="function not covered" >    function updateAdmin(address _newAdmin) external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        if (_newAdmin == address(0)) revert ZeroAddress();</span>
        admin = _newAdmin;
    }
    
    /**
     * @dev Transfers ownership of the contract
     * @param _newOwner Address of the new owner
     */
<span class="fstat-no" title="function not covered" >    function transferOwnership(address _newOwner) external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        if (_newOwner == address(0)) revert ZeroAddress();</span>
        owner = _newOwner;
    }
    
    /**
     * @dev Checks if a token is whitelisted in the protocol for use in investment, 
     *      divestment, and ragequit operations. This function is called by other
     *      contracts to ensure only approved tokens are used.
     *      Verifies if a token is approved for protocol operations.
     * @param token Address of the token to check
     * @return status True if the token is whitelisted, false otherwise
     * @notice This function should be used as a security check before any token transfer
     * @notice For Sepolia testnet deployment, the default DAI token is pre-whitelisted
     */
<span class="fstat-no" title="function not covered" >    function isTokenWhitelisted(address token) external view returns (bool) {</span>
<span class="cstat-no" title="statement not covered" >        return whitelistedTokens[token];</span>
    }
    
    /**
     * @dev Gets the proposal count
     * @return count Number of proposals created
     */
<span class="fstat-no" title="function not covered" >    function getProposalCount() external view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return proposalCounter;</span>
    }
    
    /**
     * @dev Fallback function to receive ETH
     */
    receive() external payable {}
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sun Apr 20 2025 22:56:43 GMT+0100 (British Summer Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
